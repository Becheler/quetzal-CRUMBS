<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accessing the GBIF database with Quetzal-CRUMBS &mdash; Quetzal-CRUMBS  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/readthedocs-custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Accessing the CHELSA-TraCE21k 1km climate timeseries with Quetzal-CRUMBS" href="3-chelsa.html" />
    <link rel="prev" title="Enter the Quetzal-NEST Docker container" href="1-nest.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/quetzal-crumbs-fa-white-title.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="1-nest.html">1. Enter the Quetzal-NEST</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Get GBIF presence records</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-do-we-need-to-access-gbif">Why do we need to access GBIF ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-a-scripted-approach">Why a scripted approach?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bash-command">Bash command</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output">Output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3-chelsa.html">3. Get CHELSA climate data</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-sdm.html">4. Landscape habitability reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">5. GIS pre-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">6. Spatial simulations with EGGs</a></li>
<li class="toctree-l1"><a class="reference internal" href="_autosummary/crumbs.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Quetzal-CRUMBS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Accessing the GBIF database with Quetzal-CRUMBS</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="accessing-the-gbif-database-with-quetzal-crumbs">
<h1>Accessing the GBIF database with Quetzal-CRUMBS<a class="headerlink" href="#accessing-the-gbif-database-with-quetzal-crumbs" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://www.gbif.org/">Global Biodiversity Information Facility</a> is an international network
and data infrastructure that provides open access to around 2 billions of occurrence
records.</p>
<section id="why-do-we-need-to-access-gbif">
<h2>Why do we need to access GBIF ?<a class="headerlink" href="#why-do-we-need-to-access-gbif" title="Permalink to this headline">¶</a></h2>
<p>The first step in IDDC modeling is to reconstruct a dynamic suitability map to inform every
generation (or year, or century) of the simulation of a meta-population.
This suitability map can be derived from a Species Distribution Model
(aka an Environmental Niche Model).</p>
<p>There are many models available out there, and in CRUMBS we use a model averaging over 4 classifiers:</p>
<ul class="simple">
<li><p>Random Forest (RF)</p></li>
<li><p>Extra-Tree (ET)</p></li>
<li><p>Extreme Gradient Boosting (XGB)</p></li>
<li><p>Light Gradient Boosted Machine (LGBM)</p></li>
</ul>
<p>These classifiers use spatial predictors (bioclimatic variables from CHELSA) and the following features:</p>
<ul class="simple">
<li><p>presence points (<em>retrieved from the Global Biodiversity Information Facility</em>)</p></li>
<li><p>pseudo-absence points (<em>generated from the presence points and the CHELSA Digital Elevation Model</em>).</p></li>
</ul>
<p>That is why you need GBIF: it’s a cheap, easy way to have access to presence data.</p>
</section>
<section id="why-a-scripted-approach">
<h2>Why a scripted approach?<a class="headerlink" href="#why-a-scripted-approach" title="Permalink to this headline">¶</a></h2>
<p>To integrate GBIF occurrence records in an IDDC workflow, you need to:</p>
<ol class="arabic simple">
<li><p>download the observational data</p></li>
<li><p>restrict them to your area of interest (a bounding box around your genetic sample +/- an offset in km)</p></li>
<li><p>remove the duplicated obsevations</p></li>
<li><p>download the CHELSA-TraCE21k Digital Elevation Model for the present century</p></li>
<li><p>filter out the data points that fall in the ocean cells</p></li>
<li><p>export the remaining points as a shapefile</p></li>
</ol>
<p>You could do that manually, but for reproducible science it’s nice to have these
steps configured in a script and executed programmatically: this is in essence
what the <code class="docutils literal notranslate"><span class="pre">crumbs-get-gbif</span></code> utility does.</p>
<figure class="align-center" id="id1">
<a class="with-shadow reference internal image-reference" href="_images/pipeline_CRUMBS_gbif.svg"><img alt="Quetzal crumbs-get-gbif" class="with-shadow" src="_images/pipeline_CRUMBS_gbif.svg" width="700px" /></a>
<figcaption>
<p><span class="caption-text">Effect of the <code class="docutils literal notranslate"><span class="pre">crumbs-get-gbif</span></code> command</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<section id="context">
<h3>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h3>
<p>To run this command successfully, you will need to start with a set of longitude/latitude points.
That would normally be the coordinates of your DNA samples, but if you want to
reproduce our example then just download our test data points from Github:</p>
<ol class="arabic simple">
<li><p>Go to the <a class="reference external" href="https://download-directory.github.io/">Download Directory</a> utility</p></li>
<li><p>Enter this url: <code class="docutils literal notranslate"><span class="pre">https://github.com/Becheler/quetzal-CRUMBS/tree/main/tests/data/test_points</span></code></p></li>
<li><p>Press enter to start the download</p></li>
<li><p>Extract the archive in your working directory</p></li>
<li><p>You should find 3 files: move them to your Docker working directory</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">test_points.shp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_points.shx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_points.dbf</span></code></p></li>
</ul>
</li>
</ol>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All these files are necessary. When you transfer shapefiles to different jobs,
make sure you always transfer all of them, and not only the <code class="docutils literal notranslate"><span class="pre">.shp</span></code>!</p>
</div>
</div></blockquote>
</section>
<section id="bash-command">
<h3>Bash command<a class="headerlink" href="#bash-command" title="Permalink to this headline">¶</a></h3>
<p>You can then execute this command in a terminal (or a bash script) to retrieve 30 occurrences of <em>H. binoei</em> between 1950 and 2022
with a buffer of 2.0 degrees around the bounding box of the sampling points.
The records will be saved as a <code class="docutils literal notranslate"><span class="pre">occurrences.shp</span></code> shapefile (and a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> for human readibility).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to retrieve all existing records, use the <code class="docutils literal notranslate"><span class="pre">--all</span></code> option and get rid of the <code class="docutils literal notranslate"><span class="pre">--limit</span></code>.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>crumbs-get-gbif <span class="se">\</span>
      --species <span class="s2">&quot;Heteronotia binoei&quot;</span> <span class="se">\</span>
      --points <span class="s1">&#39;test_points.shp&#39;</span> <span class="se">\</span>
      --limit <span class="m">30</span> <span class="se">\</span>
      --year <span class="s2">&quot;1950,2022&quot;</span> <span class="se">\</span>
      --buffer <span class="m">2</span>.0 <span class="se">\</span>
      --output occurrences
</pre></div>
</div>
</section>
<section id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>- Quetzal-CRUMBS - Global Biodiversity Information Facility (GBIF) wrapper for iDDC models
   ... Looking in GBIF database for Heteronotia binoei
   ... Search in the bounding box provided by tests/data/test_points/test_points.shp with buffer 2.0 degrees
   ... Bounding box used: POLYGON ((128.8515 -18.2625, 139.0335 -18.2625, 139.0335 -9.0333, 128.8515 -9.0333, 128.8515 -18.2625))
   ... For Heteronotia binoei GBIF suggested the taxon key: 2448146
   ... We identified 6591 available records in the bounding box.
   ... Option all is False, using the limit option to retrieve only the first 30 available records.
   ... 30 records retrieved.
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="1-nest.html" class="btn btn-neutral float-left" title="Enter the Quetzal-NEST Docker container" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3-chelsa.html" class="btn btn-neutral float-right" title="Accessing the CHELSA-TraCE21k 1km climate timeseries with Quetzal-CRUMBS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright © 2022 Arnaud Becheler &amp; L. Lacey Knowles.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>